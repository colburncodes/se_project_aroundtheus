!function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var r=class{constructor(e,r){t(this,"_showInputError",(e=>{const t=document.querySelector(`.${e.id}-error`);t.textContent=e.validationMessage,t.classList.add(this._settings.errorClass),e.classList.add(this._settings.inputErrorClass)})),t(this,"_hideInputError",(e=>{const t=document.querySelector(`.${e.id}-error`);t.textContent="",e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass)})),t(this,"_checkInputValidity",((e,t)=>{e.validity.valid?this._hideInputError(e,t):this._showInputError(e,t)})),t(this,"_checkFormValidity",(()=>[...this._formElement.querySelectorAll(this._settings.inputSelector)].every((e=>e.validity.valid)))),t(this,"_toggleButtonState",(()=>{this._checkFormValidity()?(this._buttonElement.classList.remove(this._settings.inactiveButtonClass),this._buttonElement.removeAttribute("disabled")):(this._buttonElement.setAttribute("disabled","true"),this._buttonElement.classList.add(this._settings.inactiveButtonClass))})),this._formElement=e,this._settings=r,this._buttonElement=this._formElement.querySelector(this._settings.submitButtonSeletor)}enableValidation(){Array.from(document.querySelectorAll(this._settings.formSelector)).forEach((e=>{e.addEventListener("submit",(function(e){e.preventDefault()}));const t=[...e.querySelectorAll(this._settings.inputSelector)];this._toggleButtonState(),e.addEventListener("reset",(()=>{setTimeout((()=>{this._toggleButtonState()}),0)})),t.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e,this._settings),this._toggleButtonState()}))}))}))}};function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var n=class{constructor(e){s(this,"_handleCloseButton",(()=>{this.closeModal()})),s(this,"_handleEscapePopup",(e=>{"Escape"===e.key&&this.closeModal()})),s(this,"_handleModalOverlay",(e=>{e.target.classList.contains(".modal")&&this.closeModal()})),this._popupElement=document.querySelector(`${e}`)}openModal(){this._popupElement.classList.add("modal__open"),document.addEventListener("keyup",this._handleEscapePopup)}closeModal(){this._popupElement.classList.remove("modal__open"),document.removeEventListener("keyup",this._handleEscapePopup)}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{e.target.classList.contains("modal__open")&&this.closeModal(),e.target.classList.contains("modal__close")&&this.closeModal()}))}},i=class extends n{constructor(e){let{popupSelector:t,handleFormSubmit:r}=e;super(t),this._modalForm=this._popupElement.querySelector(".modal__form"),this._inputs=this._modalForm.querySelectorAll(".modal__input"),this._handleFormSubmit=r,this._buttonElement=this._modalForm.querySelector(".modal__save-button")}_getInputValues(){return this._formValues={},this._inputs.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}renderLoading(e){this._buttonElement.textContent=e?"Saving...":"Save"}setEventListeners(){super.setEventListeners(),this._modalForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}closeModal(){this._modalForm.reset(),super.closeModal()}};const o="db0cb0b5-b0ef-4843-a8af-9c3db60e50cb",a={authorization:o,"Content-Type":"application/json"},l={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSeletor:".modal__save-button",inactiveButtonClass:"modal__button-disabled",inputErrorClass:"modal__input-error",errorClass:"modal__error_visible"},d=document.querySelector(".modal__form-create"),c=document.querySelector(".profile__add-button"),u=document.querySelector(".profile__avatar-edit"),h=document.querySelector(".profile__edit-button"),m=document.querySelector(".modal__input-profile-name"),_=document.querySelector(".modal__input-profile-description"),p=(document.querySelector(".card__like-button"),new class{constructor(t){let{baseUrl:r,authToken:s,headers:n}=t;e(this,"getInitialCards",(async()=>{const e=await fetch(`${this._baseUrl}/cards`,{headers:this._headers});return this._handleResponse(e)})),e(this,"addCard",(async e=>{let{name:t,link:r}=e;const s=await fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})});return this._handleResponse(s)})),e(this,"deleteCardById",(async e=>{const t=await fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers,body:JSON.stringify({id:e})});return this._handleResponse(t)})),e(this,"getUserInfo",(async()=>{const e=await fetch(`${this._baseUrl}/users/me`,{headers:this._headers});return this._handleResponse(e)})),e(this,"editUserInfo",(async e=>{let{name:t,about:r}=e;const s=await fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})});return this._handleResponse(s)})),e(this,"setUserAvatar",(async e=>{let{avatar:t}=e;const r=await fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:t})});return this._handleResponse(r)})),e(this,"changeCardLikeStatus",(async(e,t)=>{const r=await fetch(`${this._baseUrl}/cards/likes/${e}`,{method:t?"PUT":"DELETE",headers:this._headers,body:JSON.stringify({like:t})});return this._handleResponse(r)})),this._baseUrl=r,this._authToken=s,this._headers=n}_handleResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status} ${e.statusText}`)}_handleResponseError(e){console.log(`Error processing request ${e}`)}getAppInfo(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",authToken:o,headers:a})),v=document.querySelector("#modal__edit"),b=document.querySelector("#modal__create"),g=document.querySelector("#avatar-modal"),y=new class extends n{open(e){let{name:t,link:r}=e;this._imageElement=document.querySelector("#image-modal"),super.setEventListeners();const s=this._imageElement.querySelector(".modal__preview-image"),n=this._imageElement.querySelector(".modal__caption");s.src=r,s.alt=t,n.textContent=t,super.openModal()}}("#image-modal"),f=new class extends n{constructor(e){super(e),this._modalElement=document.querySelector(e),this._submitButton=this._modalElement.querySelector(".modal__save-button")}renderLoading(e){this._submitButton.textContent=e?"Deleting...":"Yes"}setSubmitAction(e){this._submitButton.addEventListener("click",e)}setEventListeners(){super.setEventListeners(),this._submitButton.classList.remove("modal__button-disabled")}}("#delete-modal"),E=new class{constructor(e,t,r){this._nameElement=document.querySelector(e),this._descriptionElement=document.querySelector(t),this._avatarElement=document.querySelector(r)}getUserInfo(){return{name:this._nameElement.textContent,role:this._descriptionElement.textContent,avatar:this._avatarElement.src}}setUserInfo(e){let{name:t,about:r}=e;this._nameElement.textContent=t,this._descriptionElement.textContent=r}setAvatar(e){this._avatarElement.src=e}}(".profile__title",".profile__description",".profile__image"),S=new r(v,l),L=new r(b,l),k=new r(g,l);function C(e,t){const r=new class{constructor(e,t){let{data:r,userId:s,handleImageClick:n,handleDeleteClick:i,handleUserLikes:o}=e;var a,l,d;a=this,d=()=>this._id,(l=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var s=r.call(e,"string");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(l="getCardId"))in a?Object.defineProperty(a,l,{value:d,enumerable:!0,configurable:!0,writable:!0}):a[l]=d,this._data=r,this._id=r._id,this._userId=s,this._ownerId=r.owner._id,this._name=r.name,this._link=r.link,this._likes=r.likes,this._cardSelector=t,this._handleImageClick=n,this._handleDeleteClick=i,this._handleUserLikes=o}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}handleDeleteCard(){this._element.remove(),this._element=null}setLikes(e){this._likes=e,this._renderLikes()}isLiked(){return this._likes.find((e=>e._id==this._userId))}_renderLikes(){this._likes.length>0&&(this.imageCountElement.textContent=this._likes.length),this.isLiked()?this.imageLikeElement.classList.add("card__like-active"):this.imageLikeElement.classList.remove("card__like-active")}_setEventListeners(){this._element.querySelector(".card__delete-button").addEventListener("click",(()=>this._handleDeleteClick())),this._element.querySelector(".card__like-button").addEventListener("click",(()=>this._handleUserLikes())),this._element.querySelector(".card__image").addEventListener("click",(()=>this._handleImageClick({name:this._name,src:this._link})))}generateCard(){return this._element=this._getTemplate(),this._setEventListeners(),this.imageElement=this._element.querySelector(".card__image"),this.imageElementText=this._element.querySelector(".card__label-text"),this.imageDeleteElement=this._element.querySelector(".card__delete-button"),this.imageLikeElement=this._element.querySelector(".card__like-button"),this.imageCountElement=this._element.querySelector(".card__like-count"),this.imageElement.src=this._link,this.imageElement.alt=this._name,this.imageElementText.textContent=this._name,this._renderLikes(),this._userId!==this._ownerId&&this.imageDeleteElement.remove(),this._element}}({data:e,userId:t,handleImageClick:()=>{y.open(e)},handleDeleteClick:()=>{const e=r.getCardId();f.openModal(),f.setSubmitAction((()=>{f.renderLoading(!0),p.deleteCardById(e).then((()=>{r.handleDeleteCard(),f.closeModal()})).catch((e=>console.error(e))).finally((()=>f.renderLoading(!1)))}))},handleUserLikes:()=>{p.changeCardLikeStatus(r.getCardId(),r.isLiked()).then((e=>r.setLikes(e.likes))).catch((e=>console.error(e)))}},"#card-template");return r.generateCard()}c.addEventListener("click",(()=>{I.openModal()}));const I=new i({popupSelector:"#modal__create",handleFormSubmit:e=>{I.renderLoading(!0),p.addCard(e).then((e=>{C(e),d.reset(),I.closeModal()})).catch((e=>{console.error(e)})).finally((()=>I.renderLoading(!1)))}});u.addEventListener("click",(()=>{q.openModal()}));const q=new i({popupSelector:"#avatar-modal",handleFormSubmit:e=>{q.renderLoading(!0),p.setUserAvatar(e).then((e=>{E.setAvatar(e),q.closeModal()})).catch((e=>console.log(e))).finally((()=>q.renderLoading(!1)))}});h.addEventListener("click",(()=>{const{name:e,role:t}=E.getUserInfo();(e=>{let{name:t,role:r}=e;m.value=t,_.value=r})({name:e,role:t}),w.openModal()}));const w=new i({popupSelector:"#modal__edit",handleFormSubmit:e=>{w.renderLoading(!0),p.editUserInfo(e).then((e=>{E.setUserInfo({name:e.name,about:e.about,avatar:e.avatar}),w.closeModal()})).catch((e=>{console.error(e)})).finally((()=>w.renderLoading(!1)))}});p.getAppInfo().then((e=>{let[t,r]=e;E.setUserInfo({name:t.name,about:t.about});const s=t.avatar;E.setAvatar(s);const n=t._id,i=new class{constructor(e,t){let{items:r,renderer:s}=e;this._items=r,this._renderer=s,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:r,renderer:e=>{const t=C(e,n);i.addItem(t)}},".cards__list");i.renderItems()})).catch((e=>{console.error(e)})),I.setEventListeners(),q.setEventListeners(),f.setEventListeners(),w.setEventListeners(),y.setEventListeners(),k.enableValidation(),L.enableValidation(),S.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q045TCxLQUFLNEwsV0FBV0ksUUFBUUYsRUFDMUIsR04ySkksQ0FDRU4sTUFBT0gsRUFDUEksU0FBV3pELElBQ1QsTUFBTUUsRUFBT0gsRUFBV0MsRUFBTUMsR0FDOUJxRCxFQUFVUyxRQUFRN0QsRUFBSyxHRDVKakIsZ0JDaUtab0QsRUFBVU8sYUFBYSxJQUV4QnJCLE9BQU83RSxJQUNOQyxRQUFRNkUsTUFBTTlFLEVBQUksSUFHdEJpRixFQUFhcEksb0JBQ2J1SSxFQUFnQnZJLG9CQUNoQm9FLEVBQWtCcEUsb0JBQ2xCMEksRUFBYzFJLG9CQUNkNkQsRUFBVzdELG9CQUVYc0YsRUFBb0IzRyxtQkFDcEIwRyxFQUFvQjFHLG1CQUNwQndHLEVBQWtCeEcsa0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3V0aWxzL0FwaS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aENvbmZpcm1hdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgRm9ybVZhbGlkYXRvciB7XG4gIGNvbnN0cnVjdG9yKGZvcm1FbGVtZW50LCBzZXR0aW5ncykge1xuICAgIHRoaXMuX2Zvcm1FbGVtZW50ID0gZm9ybUVsZW1lbnQ7XG4gICAgdGhpcy5fc2V0dGluZ3MgPSBzZXR0aW5ncztcbiAgICB0aGlzLl9idXR0b25FbGVtZW50ID0gdGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIHRoaXMuX3NldHRpbmdzLnN1Ym1pdEJ1dHRvblNlbGV0b3JcbiAgICApO1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yID0gKGlucHV0KSA9PiB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXQuaWR9LWVycm9yYCk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gaW5wdXQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgaW5wdXQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICB9O1xuXG4gIF9oaWRlSW5wdXRFcnJvciA9IChpbnB1dCkgPT4ge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0LmlkfS1lcnJvcmApO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICB9O1xuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkgPSAoaW5wdXQsIHNldHRpbmdzKSA9PiB7XG4gICAgaWYgKGlucHV0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCwgc2V0dGluZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dCwgc2V0dGluZ3MpO1xuICAgIH1cbiAgfTtcblxuICBfY2hlY2tGb3JtVmFsaWRpdHkgPSAoKSA9PiB7XG4gICAgY29uc3QgaW5wdXRMaXN0ID0gW1xuICAgICAgLi4udGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSxcbiAgICBdO1xuXG4gICAgcmV0dXJuIGlucHV0TGlzdC5ldmVyeSgoaW5wdXQpID0+IGlucHV0LnZhbGlkaXR5LnZhbGlkKTtcbiAgfTtcblxuICBfdG9nZ2xlQnV0dG9uU3RhdGUgPSAoKSA9PiB7XG4gICAgY29uc3QgaXNWYWxpZCA9IHRoaXMuX2NoZWNrRm9ybVZhbGlkaXR5KCk7XG5cbiAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG4gICAgICB0aGlzLl9idXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgfVxuICB9O1xuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5mb3JtU2VsZWN0b3IpXG4gICAgKTtcblxuICAgIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgICBmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGlucHV0cyA9IFtcbiAgICAgICAgLi4uZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSxcbiAgICAgIF07XG5cbiAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICBmb3JtRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwicmVzZXRcIiwgKCkgPT4ge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgICB9LCAwKTsgLy8gaXTigJlzIGVub3VnaCB0byBwdXQgMCBtcyBoZXJlXG4gICAgICB9KTtcblxuICAgICAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0LCB0aGlzLl9zZXR0aW5ncyk7XG4gICAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGb3JtVmFsaWRhdG9yO1xuIiwiY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgJHtwb3B1cFNlbGVjdG9yfWApO1xuICB9XG5cbiAgb3Blbk1vZGFsKCkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfX29wZW5cIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIHRoaXMuX2hhbmRsZUVzY2FwZVBvcHVwKTtcbiAgfVxuXG4gIGNsb3NlTW9kYWwoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9fb3BlblwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5faGFuZGxlRXNjYXBlUG9wdXApO1xuICB9XG5cbiAgX2hhbmRsZUNsb3NlQnV0dG9uID0gKCkgPT4ge1xuICAgIHRoaXMuY2xvc2VNb2RhbCgpO1xuICB9O1xuXG4gIF9oYW5kbGVFc2NhcGVQb3B1cCA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZU1vZGFsKCk7XG4gICAgfVxuICB9O1xuXG4gIF9oYW5kbGVNb2RhbE92ZXJsYXkgPSAoZXZ0KSA9PiB7XG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwiLm1vZGFsXCIpKSB7XG4gICAgICB0aGlzLmNsb3NlTW9kYWwoKTtcbiAgICB9XG4gIH07XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGV2dCkgPT4ge1xuICAgICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX29wZW5cIikpIHtcbiAgICAgICAgdGhpcy5jbG9zZU1vZGFsKCk7XG4gICAgICB9XG4gICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fY2xvc2VcIikpIHtcbiAgICAgICAgdGhpcy5jbG9zZU1vZGFsKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXA7XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IoeyBwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0IH0pIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9tb2RhbEZvcm0gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbiAgICB0aGlzLl9pbnB1dHMgPSB0aGlzLl9tb2RhbEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5fYnV0dG9uRWxlbWVudCA9IHRoaXMuX21vZGFsRm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zYXZlLWJ1dHRvblwiKTtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICB0aGlzLl9mb3JtVmFsdWVzID0ge307XG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goXG4gICAgICAoaW5wdXQpID0+ICh0aGlzLl9mb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWUpXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5fZm9ybVZhbHVlcztcbiAgfVxuXG4gIHJlbmRlckxvYWRpbmcoaXNMb2FkaW5nKSB7XG4gICAgaWYgKGlzTG9hZGluZykge1xuICAgICAgdGhpcy5fYnV0dG9uRWxlbWVudC50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1dHRvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcbiAgICB9XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX21vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsb3NlTW9kYWwoKSB7XG4gICAgdGhpcy5fbW9kYWxGb3JtLnJlc2V0KCk7XG4gICAgc3VwZXIuY2xvc2VNb2RhbCgpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcHVwV2l0aEZvcm07XG4iLCJleHBvcnQgY29uc3QgQkFTRV9VUkwgPSBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTJcIjtcbmV4cG9ydCBjb25zdCBBVVRIX1RPS0VOID0gXCJkYjBjYjBiNS1iMGVmLTQ4NDMtYThhZi05YzNkYjYwZTUwY2JcIjtcbmV4cG9ydCBjb25zdCBIRUFERVJTID0ge1xuICBhdXRob3JpemF0aW9uOiBBVVRIX1RPS0VOLFxuICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbn07XG5cbi8vIHZhbGlkYXRpb24gYWN0aXZhdGlvblxuZXhwb3J0IGNvbnN0IGRlZmF1bHRGb3JtQ29uZmlnID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxldG9yOiBcIi5tb2RhbF9fc2F2ZS1idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uLWRpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXQtZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxufTtcblxuZXhwb3J0IGNvbnN0IHNlbGVjdG9ycyA9IHtcbiAgY2FyZHNTZWN0aW9uOiBcIi5jYXJkc19fbGlzdFwiLFxuICBjYXJkVGVtcGxhdGU6IFwiI2NhcmQtdGVtcGxhdGVcIixcbiAgYWRkTW9kYWw6IFwiI21vZGFsX19jcmVhdGVcIixcbiAgZWRpdE1vZGFsOiBcIiNtb2RhbF9fZWRpdFwiLFxuICBhdmF0YXJNb2RhbDogXCIjYXZhdGFyLW1vZGFsXCIsXG4gIGltYWdlTW9kYWw6IFwiI21vZGFsLWltYWdlXCIsXG4gIGRlbGV0ZU1vZGFsOiBcIiNkZWxldGUtbW9kYWxcIixcbiAgY2FyZE1vZGFsRm9ybTogXCIubW9kYWxfX2Zvcm0tY3JlYXRlXCIsXG4gIHByb2ZpbGVNb2RhbEZvcm06IFwiLm1vZGFsX19mb3JtLWVkaXRcIixcbiAgbW9kYWxTZWxlY3RvcjogXCIubW9kYWxcIixcbiAgcHJvZmlsZUltYWdlOiBcIi5wcm9maWxlX19pbWFnZVwiLFxuICBwcm9maWxlVGl0bGU6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gIHByb2ZpbGVEZXNjcmlwdGlvbjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVNb2RhbEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtLWNyZWF0ZVwiKTtcbmV4cG9ydCBjb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IGF2YXRhckljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1lZGl0XCIpO1xuZXhwb3J0IGNvbnN0IGVkaXRVc2VyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlSW5wdXROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2lucHV0LXByb2ZpbGUtbmFtZVwiXG4pO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVJbnB1dERlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIubW9kYWxfX2lucHV0LXByb2ZpbGUtZGVzY3JpcHRpb25cIlxuKTtcblxuZXhwb3J0IGNvbnN0IGRlbGV0ZUNhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcblxuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aENvbmZpcm1hdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhDb25maXJtYXRpb25cIjtcblxuaW1wb3J0IHtcbiAgc2VsZWN0b3JzLFxuICBjcmVhdGVNb2RhbEZvcm0sXG4gIGFkZENhcmRCdXR0b24sXG4gIGVkaXRVc2VyQnV0dG9uLFxuICBhdmF0YXJJY29uLFxuICBwcm9maWxlSW5wdXROYW1lLFxuICBwcm9maWxlSW5wdXREZXNjcmlwdGlvbixcbiAgZGVmYXVsdEZvcm1Db25maWcsXG4gIEJBU0VfVVJMLFxuICBBVVRIX1RPS0VOLFxuICBIRUFERVJTLFxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBCQVNFX1VSTCxcbiAgYXV0aFRva2VuOiBBVVRIX1RPS0VOLFxuICBoZWFkZXJzOiBIRUFERVJTLFxufSk7XG5cbmNvbnN0IGVkaXRVc2VyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsX19lZGl0XCIpO1xuY29uc3QgYWRkQ2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb2RhbF9fY3JlYXRlXCIpO1xuY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGltYWdlUG9wdXAgPSBuZXcgUG9wdXBXaXRoSW1hZ2UoXCIjaW1hZ2UtbW9kYWxcIik7XG5cbmNvbnN0IGNvbmZpcm1hdGlvblBvcHVwID0gbmV3IFBvcHVwV2l0aENvbmZpcm1hdGlvbihzZWxlY3RvcnMuZGVsZXRlTW9kYWwpO1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyhcbiAgc2VsZWN0b3JzLnByb2ZpbGVUaXRsZSxcbiAgc2VsZWN0b3JzLnByb2ZpbGVEZXNjcmlwdGlvbixcbiAgc2VsZWN0b3JzLnByb2ZpbGVJbWFnZVxuKTtcblxuY29uc3QgZWRpdEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihlZGl0VXNlck1vZGFsLCBkZWZhdWx0Rm9ybUNvbmZpZyk7XG5jb25zdCBjcmVhdGVGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoYWRkQ2FyZE1vZGFsLCBkZWZhdWx0Rm9ybUNvbmZpZyk7XG5jb25zdCBhdmF0YXJGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoYXZhdGFyTW9kYWwsIGRlZmF1bHRGb3JtQ29uZmlnKTtcblxuZnVuY3Rpb24gY3JlYXRlQ2FyZChkYXRhLCB1c2VySWQpIHtcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxuICAgIHtcbiAgICAgIGRhdGE6IGRhdGEsXG4gICAgICB1c2VySWQ6IHVzZXJJZCxcbiAgICAgIGhhbmRsZUltYWdlQ2xpY2s6ICgpID0+IHtcbiAgICAgICAgaW1hZ2VQb3B1cC5vcGVuKGRhdGEpO1xuICAgICAgfSxcbiAgICAgIGhhbmRsZURlbGV0ZUNsaWNrOiAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGlkID0gY2FyZC5nZXRDYXJkSWQoKTtcbiAgICAgICAgY29uZmlybWF0aW9uUG9wdXAub3Blbk1vZGFsKCk7XG4gICAgICAgIGNvbmZpcm1hdGlvblBvcHVwLnNldFN1Ym1pdEFjdGlvbigoKSA9PiB7XG4gICAgICAgICAgY29uZmlybWF0aW9uUG9wdXAucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgICAgICAgICBhcGlcbiAgICAgICAgICAgIC5kZWxldGVDYXJkQnlJZChpZClcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgY2FyZC5oYW5kbGVEZWxldGVDYXJkKCk7XG4gICAgICAgICAgICAgIGNvbmZpcm1hdGlvblBvcHVwLmNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKVxuICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4gY29uZmlybWF0aW9uUG9wdXAucmVuZGVyTG9hZGluZyhmYWxzZSkpO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBoYW5kbGVVc2VyTGlrZXM6ICgpID0+IHtcbiAgICAgICAgICBhcGlcbiAgICAgICAgICAgIC5jaGFuZ2VDYXJkTGlrZVN0YXR1cyhjYXJkLmdldENhcmRJZCgpLCBjYXJkLmlzTGlrZWQoKSlcbiAgICAgICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gY2FyZC5zZXRMaWtlcyhyZXNwb25zZS5saWtlcykpXG4gICAgICAgICAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihlcnIpKTtcblxuICAgICAgfSxcbiAgICB9LFxuICAgIFwiI2NhcmQtdGVtcGxhdGVcIlxuICApO1xuICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcbn1cblxuYWRkQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhZGRGb3JtTW9kYWwub3Blbk1vZGFsKCk7XG59KTtcblxuY29uc3QgYWRkRm9ybU1vZGFsID0gbmV3IFBvcHVwV2l0aEZvcm0oe1xuICBwb3B1cFNlbGVjdG9yOiBzZWxlY3RvcnMuYWRkTW9kYWwsXG4gIGhhbmRsZUZvcm1TdWJtaXQ6IChkYXRhKSA9PiB7XG4gICAgYWRkRm9ybU1vZGFsLnJlbmRlckxvYWRpbmcodHJ1ZSk7XG4gICAgYXBpXG4gICAgICAuYWRkQ2FyZChkYXRhKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgY3JlYXRlQ2FyZChkYXRhKTtcbiAgICAgICAgY3JlYXRlTW9kYWxGb3JtLnJlc2V0KCk7XG4gICAgICAgIGFkZEZvcm1Nb2RhbC5jbG9zZU1vZGFsKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IGFkZEZvcm1Nb2RhbC5yZW5kZXJMb2FkaW5nKGZhbHNlKSk7XG4gIH0sXG59KTtcblxuYXZhdGFySWNvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhdmF0YXJGb3JtTW9kYWwub3Blbk1vZGFsKCk7XG59KTtcblxuY29uc3QgYXZhdGFyRm9ybU1vZGFsID0gbmV3IFBvcHVwV2l0aEZvcm0oe1xuICBwb3B1cFNlbGVjdG9yOiBzZWxlY3RvcnMuYXZhdGFyTW9kYWwsXG4gIGhhbmRsZUZvcm1TdWJtaXQ6IChhdmF0YXIpID0+IHtcbiAgICBhdmF0YXJGb3JtTW9kYWwucmVuZGVyTG9hZGluZyh0cnVlKTtcbiAgICBhcGlcbiAgICAgIC5zZXRVc2VyQXZhdGFyKGF2YXRhcilcbiAgICAgIC50aGVuKChhdmF0YXIpID0+IHtcbiAgICAgICAgdXNlckluZm8uc2V0QXZhdGFyKGF2YXRhcik7XG4gICAgICAgIGF2YXRhckZvcm1Nb2RhbC5jbG9zZU1vZGFsKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXG4gICAgICAuZmluYWxseSgoKSA9PiBhdmF0YXJGb3JtTW9kYWwucmVuZGVyTG9hZGluZyhmYWxzZSkpO1xuICB9LFxufSk7XG5cbmNvbnN0IGZpbGxQcm9maWxlRm9ybSA9ICh7IG5hbWUsIHJvbGUgfSkgPT4ge1xuICBwcm9maWxlSW5wdXROYW1lLnZhbHVlID0gbmFtZTtcbiAgcHJvZmlsZUlucHV0RGVzY3JpcHRpb24udmFsdWUgPSByb2xlO1xufTtcblxuZWRpdFVzZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY29uc3QgeyBuYW1lLCByb2xlIH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBmaWxsUHJvZmlsZUZvcm0oeyBuYW1lLCByb2xlIH0pO1xuICBlZGl0Rm9ybU1vZGFsLm9wZW5Nb2RhbCgpO1xufSk7XG5cbmNvbnN0IGVkaXRGb3JtTW9kYWwgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIHBvcHVwU2VsZWN0b3I6IHNlbGVjdG9ycy5lZGl0TW9kYWwsXG4gIGhhbmRsZUZvcm1TdWJtaXQ6IChkYXRhKSA9PiB7XG4gICAgZWRpdEZvcm1Nb2RhbC5yZW5kZXJMb2FkaW5nKHRydWUpO1xuICAgIGFwaVxuICAgICAgLmVkaXRVc2VySW5mbyhkYXRhKVxuICAgICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xuICAgICAgICAgIG5hbWU6IGRhdGEubmFtZSxcbiAgICAgICAgICBhYm91dDogZGF0YS5hYm91dCxcbiAgICAgICAgICBhdmF0YXI6IGRhdGEuYXZhdGFyLFxuICAgICAgICB9KTtcbiAgICAgICAgZWRpdEZvcm1Nb2RhbC5jbG9zZU1vZGFsKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IGVkaXRGb3JtTW9kYWwucmVuZGVyTG9hZGluZyhmYWxzZSkpO1xuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbdXNlciwgY2FyZHNdKSA9PiB7XG4gICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xuICAgICAgbmFtZTogdXNlci5uYW1lLFxuICAgICAgYWJvdXQ6IHVzZXIuYWJvdXQsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhdmF0YXIgPSB1c2VyLmF2YXRhcjtcbiAgICB1c2VySW5mby5zZXRBdmF0YXIoYXZhdGFyKTtcblxuICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIuX2lkO1xuICAgIGNvbnN0IGNhcmRzTGlzdCA9IG5ldyBTZWN0aW9uKFxuICAgICAge1xuICAgICAgICBpdGVtczogY2FyZHMsXG4gICAgICAgIHJlbmRlcmVyOiAoZGF0YSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNhcmQgPSBjcmVhdGVDYXJkKGRhdGEsIHVzZXJJZCk7XG4gICAgICAgICAgY2FyZHNMaXN0LmFkZEl0ZW0oY2FyZCk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgc2VsZWN0b3JzLmNhcmRzU2VjdGlvblxuICAgICk7XG4gICAgY2FyZHNMaXN0LnJlbmRlckl0ZW1zKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgY29uc29sZS5lcnJvcihlcnIpO1xuICB9KTtcblxuYWRkRm9ybU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hdmF0YXJGb3JtTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmNvbmZpcm1hdGlvblBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5lZGl0Rm9ybU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5pbWFnZVBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmF2YXRhckZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuY3JlYXRlRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5lZGl0Rm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgYXV0aFRva2VuLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9hdXRoVG9rZW4gPSBhdXRoVG9rZW47XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBfaGFuZGxlUmVzcG9uc2UocmVzcG9uc2UpIHtcbiAgICByZXR1cm4gcmVzcG9uc2Uub2tcbiAgICAgID8gcmVzcG9uc2UuanNvbigpXG4gICAgICA6IFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgfVxuXG4gIF9oYW5kbGVSZXNwb25zZUVycm9yKGVycikge1xuICAgIGNvbnNvbGUubG9nKGBFcnJvciBwcm9jZXNzaW5nIHJlcXVlc3QgJHtlcnJ9YCk7XG4gIH1cblxuICAvLyBHRVQ6IEdldCBBcHAgRGF0YSAoY2FyZHNMaXN0LCB1c2VyRGF0YSlcbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0VXNlckluZm8oKSwgdGhpcy5nZXRJbml0aWFsQ2FyZHMoKV0pO1xuICB9XG5cbiAgLy8gR0VUOiBMaXN0IG9mIGNhcmRzXG4gIGdldEluaXRpYWxDYXJkcyA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzcG9uc2UpO1xuICB9O1xuXG4gIC8vIFBPU1Q6IEFkZCBuZXcgY2FyZFxuICBhZGRDYXJkID0gYXN5bmMgKHsgbmFtZSwgbGluayB9KSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgfTtcblxuICAvLyBERUxFVEU6IERlbGV0ZSBjYXJkXG4gIGRlbGV0ZUNhcmRCeUlkID0gYXN5bmMgKGlkKSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGlkLFxuICAgICAgfSksXG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuX2hhbmRsZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgfTtcblxuICAvLyBHRVQ6IEdldHMgVXNlciBQcm9maWxlXG4gIGdldFVzZXJJbmZvID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXNwb25zZSk7XG4gIH07XG5cbiAgLy8gUEFUQ0g6IEVkaXQgVXNlciBQcm9maWxlXG4gIGVkaXRVc2VySW5mbyA9IGFzeW5jICh7IG5hbWUsIGFib3V0IH0pID0+IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pO1xuICAgIHJldHVybiB0aGlzLl9oYW5kbGVSZXNwb25zZShyZXNwb25zZSk7XG4gIH07XG5cbiAgLy8gUEFUQ0g6IEVkaXQgUHJvZmlsZSBQaWN0dXJlXG4gIHNldFVzZXJBdmF0YXIgPSBhc3luYyAoeyBhdmF0YXIgfSkgPT4ge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzcG9uc2UpO1xuICB9O1xuXG4gIC8vIFBVVCB8IERFTEVURTogQWRkIHwgUmVtb3ZlIFVzZXIgbGlrZXNcbiAgY2hhbmdlQ2FyZExpa2VTdGF0dXMgPSBhc3luYyAoY2FyZElkLCBsaWtlKSA9PiB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IGxpa2UgPyBcIlBVVFwiIDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGxpa2UsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5faGFuZGxlUmVzcG9uc2UocmVzcG9uc2UpO1xuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcblxuY2xhc3MgUG9wV2l0aEltYWdlIGV4dGVuZHMgUG9wdXAge1xuICBvcGVuKHsgbmFtZSwgbGluayB9KSB7XG4gICAgdGhpcy5faW1hZ2VFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbWFnZS1tb2RhbFwiKTtcbiAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xuXG4gICAgY29uc3QgY2FyZEltYWdlID0gdGhpcy5faW1hZ2VFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3ByZXZpZXctaW1hZ2VcIik7XG4gICAgY29uc3QgY2FyZERlc2NyaXB0aW9uID0gdGhpcy5faW1hZ2VFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbiAgICBjYXJkSW1hZ2Uuc3JjID0gbGluaztcbiAgICBjYXJkSW1hZ2UuYWx0ID0gbmFtZTtcbiAgICBjYXJkRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHN1cGVyLm9wZW5Nb2RhbCgpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFBvcFdpdGhJbWFnZTtcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5jbGFzcyBQb3B1cFdpdGhDb25maXJtYXRpb24gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIubW9kYWxfX3NhdmUtYnV0dG9uXCJcbiAgICApO1xuICB9XG5cbiAgcmVuZGVyTG9hZGluZyhpc0xvYWRpbmcpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBcIkRlbGV0aW5nLi4uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiWWVzXCI7XG4gICAgfVxuICB9XG5cbiAgc2V0U3VibWl0QWN0aW9uKGhhbmRsZVN1Ym1pdCkge1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgaGFuZGxlU3VibWl0KTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9fYnV0dG9uLWRpc2FibGVkXCIpO1xuICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoQ29uZmlybWF0aW9uO1xuIiwiY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3RvcihuYW1lU2VsZWN0b3IsIGRlc2NyaXB0aW9uU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yKSB7XG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVTZWxlY3Rvcik7XG4gICAgdGhpcy5fZGVzY3JpcHRpb25FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihkZXNjcmlwdGlvblNlbGVjdG9yKTtcbiAgICB0aGlzLl9hdmF0YXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJTZWxlY3Rvcik7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgICByb2xlOiB0aGlzLl9kZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgICBhdmF0YXI6IHRoaXMuX2F2YXRhckVsZW1lbnQuc3JjLFxuICAgIH07XG4gIH1cblxuICBzZXRVc2VySW5mbyh7IG5hbWUsIGFib3V0IH0pIHtcbiAgICB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgdGhpcy5fZGVzY3JpcHRpb25FbGVtZW50LnRleHRDb250ZW50ID0gYWJvdXQ7XG4gIH1cblxuICBzZXRBdmF0YXIoYXZhdGFyKSB7XG4gICAgdGhpcy5fYXZhdGFyRWxlbWVudC5zcmMgPSBhdmF0YXI7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVXNlckluZm87XG4iLCJjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgeyBkYXRhLCB1c2VySWQsIGhhbmRsZUltYWdlQ2xpY2ssIGhhbmRsZURlbGV0ZUNsaWNrLCBoYW5kbGVVc2VyTGlrZXMgfSxcbiAgICBjYXJkU2VsZWN0b3JcbiAgKSB7XG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcbiAgICB0aGlzLl91c2VySWQgPSB1c2VySWQ7XG4gICAgdGhpcy5fb3duZXJJZCA9IGRhdGEub3duZXIuX2lkO1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9saWtlcyA9IGRhdGEubGlrZXM7XG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVJbWFnZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrID0gaGFuZGxlRGVsZXRlQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlVXNlckxpa2VzID0gaGFuZGxlVXNlckxpa2VzO1xuICB9XG5cbiAgZ2V0Q2FyZElkID0gKCkgPT4gdGhpcy5faWQ7XG5cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG5cbiAgICByZXR1cm4gY2FyZFRlbXBsYXRlO1xuICB9XG5cbiAgaGFuZGxlRGVsZXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xuICAgIHRoaXMuX2VsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgc2V0TGlrZXMobGlrZXMpIHtcbiAgICB0aGlzLl9saWtlcyA9IGxpa2VzO1xuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XG4gIH1cblxuICBpc0xpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9saWtlcy5maW5kKChsaWtlKSA9PiB7XG4gICAgICBpZihsaWtlLl9pZCA9PSB0aGlzLl91c2VySWQpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBfcmVuZGVyTGlrZXMoKSB7XG4gICAgaWYgKHRoaXMuX2xpa2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuaW1hZ2VDb3VudEVsZW1lbnQudGV4dENvbnRlbnQgPSB0aGlzLl9saWtlcy5sZW5ndGg7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNMaWtlZCgpKSB7XG4gICAgICB0aGlzLmltYWdlTGlrZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmltYWdlTGlrZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImNhcmRfX2xpa2UtYWN0aXZlXCIpO1xuICAgIH1cbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9lbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZURlbGV0ZUNsaWNrKCkpO1xuXG4gICAgdGhpcy5fZWxlbWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIilcbiAgICAgIC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5faGFuZGxlVXNlckxpa2VzKCkpO1xuXG4gICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh7XG4gICAgICAgIG5hbWU6IHRoaXMuX25hbWUsXG4gICAgICAgIHNyYzogdGhpcy5fbGluayxcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIGdlbmVyYXRlQ2FyZCgpIHtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fZ2V0VGVtcGxhdGUoKTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuaW1hZ2VFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIHRoaXMuaW1hZ2VFbGVtZW50VGV4dCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19sYWJlbC10ZXh0XCIpO1xuICAgIHRoaXMuaW1hZ2VEZWxldGVFbGVtZW50ID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiXG4gICAgKTtcbiAgICB0aGlzLmltYWdlTGlrZUVsZW1lbnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgdGhpcy5pbWFnZUNvdW50RWxlbWVudCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWNvdW50XCIpO1xuXG4gICAgdGhpcy5pbWFnZUVsZW1lbnQuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLmltYWdlRWxlbWVudC5hbHQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuaW1hZ2VFbGVtZW50VGV4dC50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG5cbiAgICB0aGlzLl9yZW5kZXJMaWtlcygpO1xuXG4gICAgdGhpcy5fdXNlcklkICE9PSB0aGlzLl9vd25lcklkID8gdGhpcy5pbWFnZURlbGV0ZUVsZW1lbnQucmVtb3ZlKCkgOiBcIlwiO1xuXG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQ7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQ2FyZDtcbiIsImNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuXG4gIHJlbmRlckl0ZW1zKCkge1xuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShpdGVtKSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2VjdGlvbjtcbiJdLCJuYW1lcyI6WyJjb25zdHJ1Y3RvciIsImZvcm1FbGVtZW50Iiwic2V0dGluZ3MiLCJpbnB1dCIsImVycm9yRWxlbWVudCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImlkIiwidGV4dENvbnRlbnQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNsYXNzTGlzdCIsImFkZCIsInRoaXMiLCJfc2V0dGluZ3MiLCJlcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwicmVtb3ZlIiwidmFsaWRpdHkiLCJ2YWxpZCIsIl9oaWRlSW5wdXRFcnJvciIsIl9zaG93SW5wdXRFcnJvciIsIl9mb3JtRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpbnB1dFNlbGVjdG9yIiwiZXZlcnkiLCJfY2hlY2tGb3JtVmFsaWRpdHkiLCJfYnV0dG9uRWxlbWVudCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRBdHRyaWJ1dGUiLCJzdWJtaXRCdXR0b25TZWxldG9yIiwiZW5hYmxlVmFsaWRhdGlvbiIsIkFycmF5IiwiZnJvbSIsImZvcm1TZWxlY3RvciIsImZvckVhY2giLCJhZGRFdmVudExpc3RlbmVyIiwiZXZ0IiwicHJldmVudERlZmF1bHQiLCJpbnB1dHMiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJzZXRUaW1lb3V0IiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInBvcHVwU2VsZWN0b3IiLCJjbG9zZU1vZGFsIiwia2V5IiwidGFyZ2V0IiwiY29udGFpbnMiLCJfcG9wdXBFbGVtZW50Iiwib3Blbk1vZGFsIiwiX2hhbmRsZUVzY2FwZVBvcHVwIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInNldEV2ZW50TGlzdGVuZXJzIiwiUG9wdXAiLCJoYW5kbGVGb3JtU3VibWl0Iiwic3VwZXIiLCJfbW9kYWxGb3JtIiwiX2lucHV0cyIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2dldElucHV0VmFsdWVzIiwiX2Zvcm1WYWx1ZXMiLCJuYW1lIiwidmFsdWUiLCJyZW5kZXJMb2FkaW5nIiwiaXNMb2FkaW5nIiwicmVzZXQiLCJBVVRIX1RPS0VOIiwiSEVBREVSUyIsImF1dGhvcml6YXRpb24iLCJkZWZhdWx0Rm9ybUNvbmZpZyIsImNyZWF0ZU1vZGFsRm9ybSIsImFkZENhcmRCdXR0b24iLCJhdmF0YXJJY29uIiwiZWRpdFVzZXJCdXR0b24iLCJwcm9maWxlSW5wdXROYW1lIiwicHJvZmlsZUlucHV0RGVzY3JpcHRpb24iLCJhcGkiLCJiYXNlVXJsIiwiYXV0aFRva2VuIiwiaGVhZGVycyIsImFzeW5jIiwicmVzcG9uc2UiLCJmZXRjaCIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJfaGFuZGxlUmVzcG9uc2UiLCJsaW5rIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhYm91dCIsImF2YXRhciIsImNhcmRJZCIsImxpa2UiLCJfYXV0aFRva2VuIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJfaGFuZGxlUmVzcG9uc2VFcnJvciIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJnZXRBcHBJbmZvIiwiYWxsIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJlZGl0VXNlck1vZGFsIiwiYWRkQ2FyZE1vZGFsIiwiYXZhdGFyTW9kYWwiLCJpbWFnZVBvcHVwIiwib3BlbiIsIl9pbWFnZUVsZW1lbnQiLCJjYXJkSW1hZ2UiLCJjYXJkRGVzY3JpcHRpb24iLCJzcmMiLCJhbHQiLCJjb25maXJtYXRpb25Qb3B1cCIsIl9tb2RhbEVsZW1lbnQiLCJfc3VibWl0QnV0dG9uIiwic2V0U3VibWl0QWN0aW9uIiwiaGFuZGxlU3VibWl0IiwidXNlckluZm8iLCJuYW1lU2VsZWN0b3IiLCJkZXNjcmlwdGlvblNlbGVjdG9yIiwiYXZhdGFyU2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfZGVzY3JpcHRpb25FbGVtZW50IiwiX2F2YXRhckVsZW1lbnQiLCJyb2xlIiwic2V0VXNlckluZm8iLCJzZXRBdmF0YXIiLCJlZGl0Rm9ybVZhbGlkYXRvciIsIkZvcm1WYWxpZGF0b3IiLCJjcmVhdGVGb3JtVmFsaWRhdG9yIiwiYXZhdGFyRm9ybVZhbGlkYXRvciIsImNyZWF0ZUNhcmQiLCJkYXRhIiwidXNlcklkIiwiY2FyZCIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImhhbmRsZVVzZXJMaWtlcyIsIl9pZCIsIl9kYXRhIiwiX3VzZXJJZCIsIl9vd25lcklkIiwib3duZXIiLCJfbmFtZSIsIl9saW5rIiwiX2xpa2VzIiwibGlrZXMiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlRGVsZXRlQ2xpY2siLCJfaGFuZGxlVXNlckxpa2VzIiwiX2dldFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsImhhbmRsZURlbGV0ZUNhcmQiLCJfZWxlbWVudCIsInNldExpa2VzIiwiX3JlbmRlckxpa2VzIiwiaXNMaWtlZCIsImZpbmQiLCJsZW5ndGgiLCJpbWFnZUNvdW50RWxlbWVudCIsImltYWdlTGlrZUVsZW1lbnQiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJnZW5lcmF0ZUNhcmQiLCJpbWFnZUVsZW1lbnQiLCJpbWFnZUVsZW1lbnRUZXh0IiwiaW1hZ2VEZWxldGVFbGVtZW50IiwiZ2V0Q2FyZElkIiwiZGVsZXRlQ2FyZEJ5SWQiLCJ0aGVuIiwiY2F0Y2giLCJlcnJvciIsImZpbmFsbHkiLCJjaGFuZ2VDYXJkTGlrZVN0YXR1cyIsImFkZEZvcm1Nb2RhbCIsIlBvcHVwV2l0aEZvcm0iLCJhZGRDYXJkIiwiYXZhdGFyRm9ybU1vZGFsIiwic2V0VXNlckF2YXRhciIsImZpbGxQcm9maWxlRm9ybSIsImVkaXRGb3JtTW9kYWwiLCJlZGl0VXNlckluZm8iLCJ1c2VyIiwiY2FyZHMiLCJjYXJkc0xpc3QiLCJjb250YWluZXJTZWxlY3RvciIsIml0ZW1zIiwicmVuZGVyZXIiLCJfaXRlbXMiLCJfcmVuZGVyZXIiLCJfY29udGFpbmVyIiwicmVuZGVySXRlbXMiLCJpdGVtIiwiYWRkSXRlbSIsInByZXBlbmQiXSwic291cmNlUm9vdCI6IiJ9