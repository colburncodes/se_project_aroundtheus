!function(){"use strict";function e(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var r=class{constructor(e,r){t(this,"_showInputError",(e=>{const t=document.querySelector(`.${e.id}-error`);t.textContent=e.validationMessage,t.classList.add(this._settings.errorClass),e.classList.add(this._settings.inputErrorClass)})),t(this,"_hideInputError",(e=>{const t=document.querySelector(`.${e.id}-error`);t.textContent="",e.classList.remove(this._settings.inputErrorClass),t.classList.remove(this._settings.errorClass)})),t(this,"_checkInputValidity",((e,t)=>{e.validity.valid?this._hideInputError(e,t):this._showInputError(e,t)})),t(this,"_checkFormValidity",(()=>[...this._formElement.querySelectorAll(this._settings.inputSelector)].every((e=>e.validity.valid)))),t(this,"_toggleButtonState",(()=>{const e=this._checkFormValidity(),t=this._formElement.querySelector(this._settings.submitButtonSeletor);e?(t.classList.remove(this._settings.inactiveButtonClass),t.removeAttribute("disabled")):(t.setAttribute("disabled","true"),t.classList.add(this._settings.inactiveButtonClass))})),this._formElement=e,this._settings=r}enableValidation(){Array.from(document.querySelectorAll(this._settings.formSelector)).forEach((e=>{e.addEventListener("submit",(function(e){e.preventDefault()}));const t=[...e.querySelectorAll(this._settings.inputSelector)];this._toggleButtonState(),e.addEventListener("reset",(()=>{setTimeout((()=>{this._toggleButtonState()}),0)})),t.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e,this._settings),this._toggleButtonState()}))}))}))}};function n(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var s=class{constructor(e){n(this,"_handleCloseButton",(()=>{this.closeModal()})),n(this,"_handleEscapePopup",(e=>{"Escape"===e.key&&this.closeModal()})),n(this,"_handleModalOverlay",(e=>{e.target.classList.contains(".modal")&&this.closeModal()})),this._popupElement=document.querySelector(`${e}`)}openModal(){this._popupElement.classList.add("modal__open"),document.addEventListener("keyup",this._handleEscapePopup)}closeModal(){this._popupElement.classList.remove("modal__open"),document.removeEventListener("keyup",this._handleEscapePopup)}setEventListeners(){this._popupElement.addEventListener("mousedown",(e=>{e.target.classList.contains("modal__open")&&this.closeModal(),e.target.classList.contains("modal__close")&&this.closeModal()}))}},i=class extends s{constructor(e){let{popupSelector:t,handleFormSubmit:r}=e;super(t),this._modalForm=this._popupElement.querySelector(".modal__form"),this._inputs=this._modalForm.querySelectorAll(".modal__input"),this._handleFormSubmit=r}_getInputValues(){return this._formValues={},this._inputs.forEach((e=>this._formValues[e.name]=e.value)),this._formValues}setEventListeners(){super.setEventListeners(),this._modalForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}closeModal(){this._modalForm.reset(),super.closeModal()}};const o={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSeletor:".modal__save-button",inactiveButtonClass:"modal__button-disabled",inputErrorClass:"modal__input-error",errorClass:"modal__error_visible"},a=document.querySelector(".modal__form-create"),l=document.querySelector(".profile__add-button"),c=document.querySelector(".profile__edit-button"),d=document.querySelector(".modal__input-profile-name"),h=document.querySelector(".modal__input-profile-description"),u=new class{constructor(t){let{baseUrl:r,authToken:n}=t;e(this,"getInitialCards",(async()=>await fetch(`${this._baseUrl}/cards`,{headers:{authorization:this._authToken}}).then(this._handleResponse).catch((e=>this._handleResponseError(e))))),e(this,"addCard",(async e=>{let{name:t,link:r}=e;return await fetch(`${this._baseUrl}/cards`,{method:"POST",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:r})}).then(this._handleResponse).catch((e=>this._handleResponseError(e)))})),e(this,"deleteCardById",(async e=>await fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(this._handleResponse).catch((e=>this._handleResponseError(e))))),e(this,"getUserInfo",(async()=>await fetch(`${this._baseUrl}/users/me`,{headers:{authorization:this._authToken}}).then(this._handleResponse).catch((e=>this._handleResponseError(e))))),e(this,"editUserInfo",(async e=>{let{name:t,about:r}=e;return await fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:r})}).then(this._handleResponse).catch((e=>this._handleResponseError(e)))})),e(this,"setUserAvatar",(async e=>{let{avatar:t}=e;return await fetch(`${this._baseUrl}/users/me/${t}`,{method:"PATCH",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(this._handleResponse).catch((e=>this._handleResponseError(e)))})),e(this,"changeCardLikeStatus",(async(e,t)=>await fetch(`${this._baseUrl}/cards/likes/${e}`,{method:t?"PUT":"DELETE",headers:{authorization:this._authToken,"Content-Type":"application/json"},body:JSON.stringify({like:t})}).then(this._handleResponse).catch((e=>this._handleResponseError(e))))),this._baseUrl=r,this._authToken=n}_handleResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status} ${e.statusText}`)}_handleResponseError(e){console.log(`Error processing request ${e}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}}({baseUrl:"https://around.nomoreparties.co/v1/group-12",authToken:"db0cb0b5-b0ef-4843-a8af-9c3db60e50cb"}),_=document.querySelector("#modal__edit"),m=document.querySelector("#modal__create"),p=new class extends s{open(e){let{name:t,link:r}=e;this._imageElement=document.querySelector("#image-modal"),super.setEventListeners();const n=this._imageElement.querySelector(".modal__preview-image"),s=this._imageElement.querySelector(".modal__caption");n.src=r,n.alt=t,s.textContent=t,super.openModal()}}("#image-modal"),y=new class{constructor(e,t){this._nameElement=document.querySelector(e),this._descriptionElement=document.querySelector(t)}getUserInfo(){return{name:this._nameElement.textContent,role:this._descriptionElement.textContent}}setUserInfo(e){let{name:t,about:r}=e;this._nameElement.textContent=t,this._descriptionElement.textContent=r}}(".profile__title",".profile__description"),f=new r(_,o),v=new r(m,o);l.addEventListener("click",(()=>{b.openModal()}));const b=new i({popupSelector:"#modal__create",handleFormSubmit:e=>{u.addCard(e).then((e=>e)).catch((e=>{console.error(e)})),a.reset(),b.closeModal()}});c.addEventListener("click",(()=>{const{name:e,role:t}=y.getUserInfo();d.value=e,h.value=t,g.openModal()}));const g=new i({popupSelector:"#modal__edit",handleFormSubmit:e=>{u.editUserInfo(e).then((e=>{y.setUserInfo({name:e.name,about:e.about})})).catch((e=>{console.error(e)})),g.closeModal()}});let E;u.getAppInfo().then((e=>{let[t,r]=e;E=r._id,y.setUserInfo({name:r.name,about:r.about});const n=new class{constructor(e,t){let{items:r,renderer:n}=e;this._items=r,this._renderer=n,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:t,renderer:e=>{const t=new class{constructor(e,t){let{data:r,handleImageClick:n,handleDeleteClick:s,handleUserLikes:i}=e;var o,a,l;o=this,l=()=>this._element.querySelector(".card__like-button").classList.toggle("card__like-active"),(a=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(a="handleLikeIcon"))in o?Object.defineProperty(o,a,{value:l,enumerable:!0,configurable:!0,writable:!0}):o[a]=l,this._id=r._id,this._ownerId=r.owner._id,this._name=r.name,this._link=r.link,this._likes=r.likes,this._cardSelector=t,this._handleImageClick=n,this._handleDeleteClick=s,this._handleUserLikes=i}getById(){return this._id}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}handleDeleteCard(){this._element.remove(),this._element=null}_setEventListeners(){this._element.querySelector(".card__delete-button").addEventListener("click",(()=>this._handleDeleteClick())),this._element.querySelector(".card__like-button").addEventListener("click",(()=>this._handleUserLikes())),this._element.querySelector(".card__image").addEventListener("click",(()=>this._handleImageClick({name:this._name,src:this._link})))}generateCard(){this._element=this._getTemplate(),this._setEventListeners();const e=this._element.querySelector(".card__image"),t=this._element.querySelector(".card__label-text");return e.src=this._link,e.alt=this._name,t.textContent=this._name,this._element}}({data:e,handleImageClick:()=>{p.open(e)},handleDeleteClick:()=>{const r=t.getById(),n=e.owner._id;E===n&&u.deleteCardById(r).then((()=>{t.handleDeleteCard(),console.log("Card was deleted successfully")})).catch((e=>console.error(e)))},handleUserLikes:()=>{const e=t.getById();u.addUserLikes(e).then((()=>{t.handleLikeIcon()}))}},"#card-template");n.addItem(t.generateCard())}},".cards__list");n.renderItems()})).catch((e=>{console.error(e)})),g.setEventListeners(),b.setEventListeners(),p.setEventListeners(),f.enableValidation(),v.enableValidation()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WixNQUFLLEtBQ0pvRSxFQUFLcUIsbUJBQ0xwRSxRQUFRQyxJQUFLLGdDQUErQixJQUU3Q3BCLE9BQU9DLEdBQVFrQixRQUFRNkIsTUFBTS9DLElBR2xDLEVBRUZxRSxnQkFBaUIsS0FDZixNQUFNNUQsRUFBU3dELEVBQUtpQixVQUNwQjlGLEVBQUl5RyxhQUFhcEYsR0FBUVosTUFBSyxLQUM1Qm9FLEVBQUs2QixnQkFBZ0IsR0FDckIsR0FHTixrQkFFRnhDLEVBQVVTLFFBQVFFLEVBQUt1QixlQUFlLEdEbEhoQyxnQkN1SFpsQyxFQUFVTyxhQUFhLElBRXhCOUQsT0FBT0MsSUFDTmtCLFFBQVE2QixNQUFNL0MsRUFBSSxJQUd0QmdELEVBQWM5RSxvQkFDZHlFLEVBQWF6RSxvQkFDYndELEVBQVd4RCxvQkFFWHNFLEVBQWtCM0YsbUJBQ2xCNkYsRUFBb0I3RixrQiIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvU2VjdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X2Fyb3VuZHRoZXVzLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3IoZm9ybUVsZW1lbnQsIHNldHRpbmdzKSB7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQgPSBmb3JtRWxlbWVudDtcbiAgICB0aGlzLl9zZXR0aW5ncyA9IHNldHRpbmdzO1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yID0gKGlucHV0KSA9PiB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLiR7aW5wdXQuaWR9LWVycm9yYCk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gaW5wdXQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fc2V0dGluZ3MuZXJyb3JDbGFzcyk7XG4gICAgaW5wdXQuY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICB9O1xuXG4gIF9oaWRlSW5wdXRFcnJvciA9IChpbnB1dCkgPT4ge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0LmlkfS1lcnJvcmApO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9zZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX3NldHRpbmdzLmVycm9yQ2xhc3MpO1xuICB9O1xuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkgPSAoaW5wdXQsIHNldHRpbmdzKSA9PiB7XG4gICAgaWYgKGlucHV0LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dCwgc2V0dGluZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dCwgc2V0dGluZ3MpO1xuICAgIH1cbiAgfTtcblxuICBfY2hlY2tGb3JtVmFsaWRpdHkgPSAoKSA9PiB7XG4gICAgY29uc3QgaW5wdXRMaXN0ID0gW1xuICAgICAgLi4udGhpcy5fZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9zZXR0aW5ncy5pbnB1dFNlbGVjdG9yKSxcbiAgICBdO1xuICAgIHJldHVybiBpbnB1dExpc3QuZXZlcnkoKGlucHV0KSA9PiBpbnB1dC52YWxpZGl0eS52YWxpZCk7XG4gIH07XG5cbiAgX3RvZ2dsZUJ1dHRvblN0YXRlID0gKCkgPT4ge1xuICAgIGNvbnN0IGlzVmFsaWQgPSB0aGlzLl9jaGVja0Zvcm1WYWxpZGl0eSgpO1xuICAgIGNvbnN0IGJ1dHRvbiA9IHRoaXMuX2Zvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICB0aGlzLl9zZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxldG9yXG4gICAgKTtcbiAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICBidXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIik7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9zZXR0aW5ncy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB9XG4gIH07XG5cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmZvcm1TZWxlY3RvcilcbiAgICApO1xuXG4gICAgZm9ybUxpc3QuZm9yRWFjaCgoZm9ybUVsZW1lbnQpID0+IHtcbiAgICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgaW5wdXRzID0gW1xuICAgICAgICAuLi5mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX3NldHRpbmdzLmlucHV0U2VsZWN0b3IpLFxuICAgICAgXTtcblxuICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICAgIGZvcm1FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNldFwiLCAoKSA9PiB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICAgIH0sIDApOyAvLyBpdOKAmXMgZW5vdWdoIHRvIHB1dCAwIG1zIGhlcmVcbiAgICAgIH0pO1xuXG4gICAgICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXQsIHRoaXMuX3NldHRpbmdzKTtcbiAgICAgICAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEZvcm1WYWxpZGF0b3I7XG4iLCJjbGFzcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAke3BvcHVwU2VsZWN0b3J9YCk7XG4gIH1cblxuICBvcGVuTW9kYWwoKSB7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9fb3BlblwiKTtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgdGhpcy5faGFuZGxlRXNjYXBlUG9wdXApO1xuICB9XG5cbiAgY2xvc2VNb2RhbCgpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX19vcGVuXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCB0aGlzLl9oYW5kbGVFc2NhcGVQb3B1cCk7XG4gIH1cblxuICBfaGFuZGxlQ2xvc2VCdXR0b24gPSAoKSA9PiB7XG4gICAgdGhpcy5jbG9zZU1vZGFsKCk7XG4gIH07XG5cbiAgX2hhbmRsZUVzY2FwZVBvcHVwID0gKGV2dCkgPT4ge1xuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlTW9kYWwoKTtcbiAgICB9XG4gIH07XG5cbiAgX2hhbmRsZU1vZGFsT3ZlcmxheSA9IChldnQpID0+IHtcbiAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCIubW9kYWxcIikpIHtcbiAgICAgIHRoaXMuY2xvc2VNb2RhbCgpO1xuICAgIH1cbiAgfTtcblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB7XG4gICAgICBpZiAoZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9fb3BlblwiKSkge1xuICAgICAgICB0aGlzLmNsb3NlTW9kYWwoKTtcbiAgICAgIH1cbiAgICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX19jbG9zZVwiKSkge1xuICAgICAgICB0aGlzLmNsb3NlTW9kYWwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3B1cDtcbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuXG5jbGFzcyBQb3B1cFdpdGhGb3JtIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQgfSkge1xuICAgIHN1cGVyKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX21vZGFsRm9ybSA9IHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuICAgIHRoaXMuX2lucHV0cyA9IHRoaXMuX21vZGFsRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICB0aGlzLl9mb3JtVmFsdWVzID0ge307XG4gICAgdGhpcy5faW5wdXRzLmZvckVhY2goXG4gICAgICAoaW5wdXQpID0+ICh0aGlzLl9mb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWUpXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5fZm9ybVZhbHVlcztcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fbW9kYWxGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgY2xvc2VNb2RhbCgpIHtcbiAgICB0aGlzLl9tb2RhbEZvcm0ucmVzZXQoKTtcbiAgICBzdXBlci5jbG9zZU1vZGFsKCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUG9wdXBXaXRoRm9ybTtcbiIsImV4cG9ydCBjb25zdCBCQVNFX1VSTCA9IFwiaHR0cHM6Ly9hcm91bmQubm9tb3JlcGFydGllcy5jby92MS9ncm91cC0xMlwiO1xuZXhwb3J0IGNvbnN0IEFVVEhfVE9LRU4gPSBcImRiMGNiMGI1LWIwZWYtNDg0My1hOGFmLTljM2RiNjBlNTBjYlwiO1xuXG4vLyB2YWxpZGF0aW9uIGFjdGl2YXRpb25cbmV4cG9ydCBjb25zdCBkZWZhdWx0Rm9ybUNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZXRvcjogXCIubW9kYWxfX3NhdmUtYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbi1kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0LWVycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbmV4cG9ydCBjb25zdCBzZWxlY3RvcnMgPSB7XG4gIGNhcmRzU2VjdGlvbjogXCIuY2FyZHNfX2xpc3RcIixcbiAgY2FyZFRlbXBsYXRlOiBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gIGFkZE1vZGFsOiBcIiNtb2RhbF9fY3JlYXRlXCIsXG4gIGVkaXRNb2RhbDogXCIjbW9kYWxfX2VkaXRcIixcbiAgaW1hZ2VNb2RhbDogXCIjbW9kYWwtaW1hZ2VcIixcbiAgZGVsZXRlTW9kYWw6IFwiI2RlbGV0ZS1tb2RhbFwiLFxuICBjYXJkTW9kYWxGb3JtOiBcIi5tb2RhbF9fZm9ybS1jcmVhdGVcIixcbiAgcHJvZmlsZU1vZGFsRm9ybTogXCIubW9kYWxfX2Zvcm0tZWRpdFwiLFxuICBtb2RhbFNlbGVjdG9yOiBcIi5tb2RhbFwiLFxuICBwcm9maWxlVGl0bGU6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gIHByb2ZpbGVEZXNjcmlwdGlvbjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbn07XG5cbmV4cG9ydCBjb25zdCBjcmVhdGVNb2RhbEZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtLWNyZWF0ZVwiKTtcbmV4cG9ydCBjb25zdCBhZGRDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuXG5leHBvcnQgY29uc3QgZWRpdFVzZXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xuLy8gZXhwb3J0IGNvbnN0IGRlbGV0ZUljb25CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZUlucHV0TmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19pbnB1dC1wcm9maWxlLW5hbWVcIlxuKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlSW5wdXREZXNjcmlwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19pbnB1dC1wcm9maWxlLWRlc2NyaXB0aW9uXCJcbik7XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuXG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xuaW1wb3J0IFNlY3Rpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvbi5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoRm9ybSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzXCI7XG5pbXBvcnQgUG9wdXBXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2UuanNcIjtcblxuaW1wb3J0IHtcbiAgc2VsZWN0b3JzLFxuICBjcmVhdGVNb2RhbEZvcm0sXG4gIGFkZENhcmRCdXR0b24sXG4gIGVkaXRVc2VyQnV0dG9uLFxuICBwcm9maWxlSW5wdXROYW1lLFxuICBwcm9maWxlSW5wdXREZXNjcmlwdGlvbixcbiAgZGVmYXVsdEZvcm1Db25maWcsXG4gIEJBU0VfVVJMLFxuICBBVVRIX1RPS0VOLFxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBCQVNFX1VSTCxcbiAgYXV0aFRva2VuOiBBVVRIX1RPS0VOLFxufSk7XG5cbmNvbnN0IGVkaXRVc2VyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21vZGFsX19lZGl0XCIpO1xuY29uc3QgYWRkQ2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb2RhbF9fY3JlYXRlXCIpO1xuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIiNpbWFnZS1tb2RhbFwiKTtcblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oXG4gIHNlbGVjdG9ycy5wcm9maWxlVGl0bGUsXG4gIHNlbGVjdG9ycy5wcm9maWxlRGVzY3JpcHRpb25cbik7XG5cbmNvbnN0IGVkaXRGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoZWRpdFVzZXJNb2RhbCwgZGVmYXVsdEZvcm1Db25maWcpO1xuY29uc3QgY3JlYXRlRm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKGFkZENhcmRNb2RhbCwgZGVmYXVsdEZvcm1Db25maWcpO1xuXG5hZGRDYXJkQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGFkZEZvcm1Nb2RhbC5vcGVuTW9kYWwoKTtcbn0pO1xuXG5jb25zdCBhZGRGb3JtTW9kYWwgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIHBvcHVwU2VsZWN0b3I6IHNlbGVjdG9ycy5hZGRNb2RhbCxcbiAgaGFuZGxlRm9ybVN1Ym1pdDogKGRhdGEpID0+IHtcbiAgICBhcGlcbiAgICAgIC5hZGRDYXJkKGRhdGEpXG4gICAgICAudGhlbigoZGF0YSkgPT4gZGF0YSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH0pO1xuICAgIGNyZWF0ZU1vZGFsRm9ybS5yZXNldCgpO1xuICAgIGFkZEZvcm1Nb2RhbC5jbG9zZU1vZGFsKCk7XG4gIH0sXG59KTtcblxuZWRpdFVzZXJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY29uc3QgeyBuYW1lLCByb2xlIH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xuICBwcm9maWxlSW5wdXROYW1lLnZhbHVlID0gbmFtZTtcbiAgcHJvZmlsZUlucHV0RGVzY3JpcHRpb24udmFsdWUgPSByb2xlO1xuICBlZGl0Rm9ybU1vZGFsLm9wZW5Nb2RhbCgpO1xufSk7XG5cbmNvbnN0IGVkaXRGb3JtTW9kYWwgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIHBvcHVwU2VsZWN0b3I6IHNlbGVjdG9ycy5lZGl0TW9kYWwsXG4gIGhhbmRsZUZvcm1TdWJtaXQ6IChkYXRhKSA9PiB7XG4gICAgYXBpXG4gICAgICAuZWRpdFVzZXJJbmZvKGRhdGEpXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XG4gICAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxuICAgICAgICAgIGFib3V0OiBkYXRhLmFib3V0LFxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9KTtcbiAgICBlZGl0Rm9ybU1vZGFsLmNsb3NlTW9kYWwoKTtcbiAgfSxcbn0pO1xuXG5sZXQgdXNlcklkO1xuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlcl0pID0+IHtcbiAgICB1c2VySWQgPSB1c2VyLl9pZDtcblxuICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IHVzZXIubmFtZSxcbiAgICAgIGFib3V0OiB1c2VyLmFib3V0LFxuICAgIH0pO1xuXG4gICAgY29uc3QgY2FyZHNMaXN0ID0gbmV3IFNlY3Rpb24oXG4gICAgICB7XG4gICAgICAgIGl0ZW1zOiBjYXJkcyxcbiAgICAgICAgcmVuZGVyZXI6IChkYXRhKSA9PiB7XG4gICAgICAgICAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBkYXRhLFxuICAgICAgICAgICAgICBoYW5kbGVJbWFnZUNsaWNrOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaW1hZ2VQb3B1cC5vcGVuKGRhdGEpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBoYW5kbGVEZWxldGVDbGljazogKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhcmRJZCA9IGNhcmQuZ2V0QnlJZCgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG93bmVySWQgPSBkYXRhLm93bmVyLl9pZDtcblxuICAgICAgICAgICAgICAgIGlmICh1c2VySWQgPT09IG93bmVySWQpIHtcbiAgICAgICAgICAgICAgICAgIGFwaVxuICAgICAgICAgICAgICAgICAgICAuZGVsZXRlQ2FyZEJ5SWQoY2FyZElkKVxuICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgY2FyZC5oYW5kbGVEZWxldGVDYXJkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYENhcmQgd2FzIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBoYW5kbGVVc2VyTGlrZXM6ICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBjYXJkSWQgPSBjYXJkLmdldEJ5SWQoKTtcbiAgICAgICAgICAgICAgICBhcGkuYWRkVXNlckxpa2VzKGNhcmRJZCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjYXJkLmhhbmRsZUxpa2VJY29uKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCIjY2FyZC10ZW1wbGF0ZVwiXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjYXJkc0xpc3QuYWRkSXRlbShjYXJkLmdlbmVyYXRlQ2FyZCgpKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzZWxlY3RvcnMuY2FyZHNTZWN0aW9uXG4gICAgKTtcbiAgICBjYXJkc0xpc3QucmVuZGVySXRlbXMoKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmVycm9yKGVycik7XG4gIH0pO1xuXG5lZGl0Rm9ybU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5hZGRGb3JtTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuZWRpdEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuY3JlYXRlRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG4iLCJjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGF1dGhUb2tlbiB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5fYXV0aFRva2VuID0gYXV0aFRva2VuO1xuICB9XG5cbiAgX2hhbmRsZVJlc3BvbnNlKHJlc3BvbnNlKSB7XG4gICAgcmV0dXJuIHJlc3BvbnNlLm9rXG4gICAgICA/IHJlc3BvbnNlLmpzb24oKVxuICAgICAgOiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gIH1cblxuICBfaGFuZGxlUmVzcG9uc2VFcnJvcihlcnIpIHtcbiAgICBjb25zb2xlLmxvZyhgRXJyb3IgcHJvY2Vzc2luZyByZXF1ZXN0ICR7ZXJyfWApO1xuICB9XG5cbiAgLy8gR0VUOiBHZXQgQXBwIERhdGEgKGNhcmRzTGlzdCwgdXNlckRhdGEpXG4gIGdldEFwcEluZm8oKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXJJbmZvKCldKTtcbiAgfVxuXG4gIC8vIEdFVDogTGlzdCBvZiBjYXJkc1xuICBnZXRJbml0aWFsQ2FyZHMgPSBhc3luYyAoKSA9PiB7XG4gICAgcmV0dXJuIGF3YWl0IGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogeyBhdXRob3JpemF0aW9uOiB0aGlzLl9hdXRoVG9rZW4gfSxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpXG4gICAgICAuY2F0Y2goKGVycikgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2VFcnJvcihlcnIpKTtcbiAgfTtcblxuICAvLyBQT1NUOiBBZGQgbmV3IGNhcmRcbiAgYWRkQ2FyZCA9IGFzeW5jICh7IG5hbWUsIGxpbmsgfSkgPT4ge1xuICAgIHJldHVybiBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX2F1dGhUb2tlbixcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSlcbiAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKVxuICAgICAgLmNhdGNoKChlcnIpID0+IHRoaXMuX2hhbmRsZVJlc3BvbnNlRXJyb3IoZXJyKSk7XG4gIH07XG5cbiAgLy8gREVMRVRFOiBEZWxldGUgY2FyZFxuICBkZWxldGVDYXJkQnlJZCA9IGFzeW5jIChpZCkgPT4ge1xuICAgIHJldHVybiBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2lkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aFRva2VuLFxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGlkLFxuICAgICAgfSksXG4gICAgfSlcbiAgICAgIC50aGVuKHRoaXMuX2hhbmRsZVJlc3BvbnNlKVxuICAgICAgLmNhdGNoKChlcnIpID0+IHRoaXMuX2hhbmRsZVJlc3BvbnNlRXJyb3IoZXJyKSk7XG4gIH07XG5cbiAgLy8gR0VUOiBHZXRzIFVzZXIgUHJvZmlsZVxuICBnZXRVc2VySW5mbyA9IGFzeW5jICgpID0+IHtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246IHRoaXMuX2F1dGhUb2tlbiB9LFxuICAgIH0pXG4gICAgICAudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZUVycm9yKGVycikpO1xuICB9O1xuXG4gIC8vIFBBVENIOiBFZGl0IFVzZXIgUHJvZmlsZVxuICBlZGl0VXNlckluZm8gPSBhc3luYyAoeyBuYW1lLCBhYm91dCB9KSA9PiB7XG4gICAgcmV0dXJuIGF3YWl0IGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX2F1dGhUb2tlbixcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pXG4gICAgICAudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB0aGlzLl9oYW5kbGVSZXNwb25zZUVycm9yKGVycikpO1xuICB9O1xuXG4gIC8vIFBBVENIOiBFZGl0IFByb2ZpbGUgUGljdHVyZVxuICBzZXRVc2VyQXZhdGFyID0gYXN5bmMgKHsgYXZhdGFyIH0pID0+IHtcbiAgICByZXR1cm4gYXdhaXQgZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvJHthdmF0YXJ9YCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGF1dGhvcml6YXRpb246IHRoaXMuX2F1dGhUb2tlbixcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpXG4gICAgICAuY2F0Y2goKGVycikgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2VFcnJvcihlcnIpKTtcbiAgfTtcblxuICAvLyBQVVQgfCBERUxFVEU6IEFkZCB8IFJlbW92ZSBVc2VyIGxpa2VzXG4gIGNoYW5nZUNhcmRMaWtlU3RhdHVzID0gYXN5bmMgKGNhcmRJZCwgbGlrZSkgPT4ge1xuICAgIHJldHVybiBhd2FpdCBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XG4gICAgICBtZXRob2Q6IGxpa2UgPyBcIlBVVFwiIDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgYXV0aG9yaXphdGlvbjogdGhpcy5fYXV0aFRva2VuLFxuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGxpa2UsXG4gICAgICB9KSxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5faGFuZGxlUmVzcG9uc2UpXG4gICAgICAuY2F0Y2goKGVycikgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2VFcnJvcihlcnIpKTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5cbmNsYXNzIFBvcFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgb3Blbih7IG5hbWUsIGxpbmsgfSkge1xuICAgIHRoaXMuX2ltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaW1hZ2UtbW9kYWxcIik7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuICAgIGNvbnN0IGNhcmRJbWFnZSA9IHRoaXMuX2ltYWdlRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19wcmV2aWV3LWltYWdlXCIpO1xuICAgIGNvbnN0IGNhcmREZXNjcmlwdGlvbiA9IHRoaXMuX2ltYWdlRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG4gICAgY2FyZEltYWdlLnNyYyA9IGxpbms7XG4gICAgY2FyZEltYWdlLmFsdCA9IG5hbWU7XG4gICAgY2FyZERlc2NyaXB0aW9uLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICBzdXBlci5vcGVuTW9kYWwoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBQb3BXaXRoSW1hZ2U7XG4iLCJjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKG5hbWVTZWxlY3RvciwgZGVzY3JpcHRpb25TZWxlY3Rvcikge1xuICAgIHRoaXMuX25hbWVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpO1xuICAgIHRoaXMuX2Rlc2NyaXB0aW9uRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoZGVzY3JpcHRpb25TZWxlY3Rvcik7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgICByb2xlOiB0aGlzLl9kZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgfTtcbiAgfVxuXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcbiAgICB0aGlzLl9kZXNjcmlwdGlvbkVsZW1lbnQudGV4dENvbnRlbnQgPSBhYm91dDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBVc2VySW5mbztcbiIsImNsYXNzIFNlY3Rpb24ge1xuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBjb250YWluZXJTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNvbnRhaW5lclNlbGVjdG9yKTtcbiAgfVxuXG4gIHJlbmRlckl0ZW1zKCkge1xuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShpdGVtKSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU2VjdGlvbjtcbiIsImNsYXNzIENhcmQge1xuICBjb25zdHJ1Y3RvcihcbiAgICB7IGRhdGEsIGhhbmRsZUltYWdlQ2xpY2ssIGhhbmRsZURlbGV0ZUNsaWNrLCBoYW5kbGVVc2VyTGlrZXMgfSxcbiAgICBjYXJkU2VsZWN0b3JcbiAgKSB7XG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcbiAgICB0aGlzLl9vd25lcklkID0gZGF0YS5vd25lci5faWQ7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2xpa2VzID0gZGF0YS5saWtlcztcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZUltYWdlQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2sgPSBoYW5kbGVEZWxldGVDbGljaztcbiAgICB0aGlzLl9oYW5kbGVVc2VyTGlrZXMgPSBoYW5kbGVVc2VyTGlrZXM7XG4gIH1cblxuICBnZXRCeUlkKCkge1xuICAgIHJldHVybiB0aGlzLl9pZDtcbiAgfVxuXG4gIF9nZXRUZW1wbGF0ZSgpIHtcbiAgICBjb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuXG4gICAgcmV0dXJuIGNhcmRUZW1wbGF0ZTtcbiAgfVxuXG4gIGhhbmRsZUxpa2VJY29uID0gKCkgPT5cbiAgICB0aGlzLl9lbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxuICAgICAgLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWFjdGl2ZVwiKTtcblxuICBoYW5kbGVEZWxldGVDYXJkKCkge1xuICAgIHRoaXMuX2VsZW1lbnQucmVtb3ZlKCk7XG4gICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fZWxlbWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLl9oYW5kbGVEZWxldGVDbGljaygpKTtcblxuICAgIHRoaXMuX2VsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXG4gICAgICAuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuX2hhbmRsZVVzZXJMaWtlcygpKTtcblxuICAgIHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2soe1xuICAgICAgICBuYW1lOiB0aGlzLl9uYW1lLFxuICAgICAgICBzcmM6IHRoaXMuX2xpbmssXG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBnZW5lcmF0ZUNhcmQoKSB7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gICAgY29uc3QgaW1hZ2VFbGVtZW50VGV4dCA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19sYWJlbC10ZXh0XCIpO1xuXG4gICAgaW1hZ2VFbGVtZW50LnNyYyA9IHRoaXMuX2xpbms7XG4gICAgaW1hZ2VFbGVtZW50LmFsdCA9IHRoaXMuX25hbWU7XG4gICAgaW1hZ2VFbGVtZW50VGV4dC50ZXh0Q29udGVudCA9IHRoaXMuX25hbWU7XG5cbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDYXJkO1xuIl0sIm5hbWVzIjpbImNvbnN0cnVjdG9yIiwiZm9ybUVsZW1lbnQiLCJzZXR0aW5ncyIsImlucHV0IiwiZXJyb3JFbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiY2xhc3NMaXN0IiwiYWRkIiwidGhpcyIsIl9zZXR0aW5ncyIsImVycm9yQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJyZW1vdmUiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hpZGVJbnB1dEVycm9yIiwiX3Nob3dJbnB1dEVycm9yIiwiX2Zvcm1FbGVtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJldmVyeSIsImlzVmFsaWQiLCJfY2hlY2tGb3JtVmFsaWRpdHkiLCJidXR0b24iLCJzdWJtaXRCdXR0b25TZWxldG9yIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEF0dHJpYnV0ZSIsImVuYWJsZVZhbGlkYXRpb24iLCJBcnJheSIsImZyb20iLCJmb3JtU2VsZWN0b3IiLCJmb3JFYWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInByZXZlbnREZWZhdWx0IiwiaW5wdXRzIiwiX3RvZ2dsZUJ1dHRvblN0YXRlIiwic2V0VGltZW91dCIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJwb3B1cFNlbGVjdG9yIiwiY2xvc2VNb2RhbCIsImtleSIsInRhcmdldCIsImNvbnRhaW5zIiwiX3BvcHVwRWxlbWVudCIsIm9wZW5Nb2RhbCIsIl9oYW5kbGVFc2NhcGVQb3B1cCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzZXRFdmVudExpc3RlbmVycyIsIlBvcHVwIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX21vZGFsRm9ybSIsIl9pbnB1dHMiLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9nZXRJbnB1dFZhbHVlcyIsIl9mb3JtVmFsdWVzIiwibmFtZSIsInZhbHVlIiwicmVzZXQiLCJkZWZhdWx0Rm9ybUNvbmZpZyIsImNyZWF0ZU1vZGFsRm9ybSIsImFkZENhcmRCdXR0b24iLCJlZGl0VXNlckJ1dHRvbiIsInByb2ZpbGVJbnB1dE5hbWUiLCJwcm9maWxlSW5wdXREZXNjcmlwdGlvbiIsImFwaSIsImJhc2VVcmwiLCJhdXRoVG9rZW4iLCJhc3luYyIsImZldGNoIiwiX2Jhc2VVcmwiLCJoZWFkZXJzIiwiYXV0aG9yaXphdGlvbiIsIl9hdXRoVG9rZW4iLCJ0aGVuIiwiX2hhbmRsZVJlc3BvbnNlIiwiY2F0Y2giLCJlcnIiLCJfaGFuZGxlUmVzcG9uc2VFcnJvciIsImxpbmsiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFib3V0IiwiYXZhdGFyIiwiY2FyZElkIiwibGlrZSIsInJlc3BvbnNlIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJjb25zb2xlIiwibG9nIiwiZ2V0QXBwSW5mbyIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiZWRpdFVzZXJNb2RhbCIsImFkZENhcmRNb2RhbCIsImltYWdlUG9wdXAiLCJvcGVuIiwiX2ltYWdlRWxlbWVudCIsImNhcmRJbWFnZSIsImNhcmREZXNjcmlwdGlvbiIsInNyYyIsImFsdCIsInVzZXJJbmZvIiwibmFtZVNlbGVjdG9yIiwiZGVzY3JpcHRpb25TZWxlY3RvciIsIl9uYW1lRWxlbWVudCIsIl9kZXNjcmlwdGlvbkVsZW1lbnQiLCJyb2xlIiwic2V0VXNlckluZm8iLCJlZGl0Rm9ybVZhbGlkYXRvciIsIkZvcm1WYWxpZGF0b3IiLCJjcmVhdGVGb3JtVmFsaWRhdG9yIiwiYWRkRm9ybU1vZGFsIiwiUG9wdXBXaXRoRm9ybSIsImRhdGEiLCJhZGRDYXJkIiwiZXJyb3IiLCJlZGl0Rm9ybU1vZGFsIiwiZWRpdFVzZXJJbmZvIiwidXNlcklkIiwiY2FyZHMiLCJ1c2VyIiwiX2lkIiwiY2FyZHNMaXN0IiwiY29udGFpbmVyU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX2NvbnRhaW5lciIsInJlbmRlckl0ZW1zIiwiaXRlbSIsImFkZEl0ZW0iLCJwcmVwZW5kIiwiY2FyZCIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImhhbmRsZVVzZXJMaWtlcyIsIl9lbGVtZW50IiwidG9nZ2xlIiwiX293bmVySWQiLCJvd25lciIsIl9uYW1lIiwiX2xpbmsiLCJfbGlrZXMiLCJsaWtlcyIsIl9jYXJkU2VsZWN0b3IiLCJfaGFuZGxlSW1hZ2VDbGljayIsIl9oYW5kbGVEZWxldGVDbGljayIsIl9oYW5kbGVVc2VyTGlrZXMiLCJnZXRCeUlkIiwiX2dldFRlbXBsYXRlIiwiY29udGVudCIsImNsb25lTm9kZSIsImhhbmRsZURlbGV0ZUNhcmQiLCJfc2V0RXZlbnRMaXN0ZW5lcnMiLCJnZW5lcmF0ZUNhcmQiLCJpbWFnZUVsZW1lbnQiLCJpbWFnZUVsZW1lbnRUZXh0Iiwib3duZXJJZCIsImRlbGV0ZUNhcmRCeUlkIiwiYWRkVXNlckxpa2VzIiwiaGFuZGxlTGlrZUljb24iXSwic291cmNlUm9vdCI6IiJ9